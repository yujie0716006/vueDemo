{"version":3,"sources":["../../../../my-project/src/vendor/Export2Excel.js"],"names":["export_table_to_excel","export_json_to_excel","require","generateArray","table","out","rows","querySelectorAll","ranges","R","length","outRow","row","columns","C","cell","colspan","getAttribute","rowspan","cellValue","innerText","forEach","range","s","r","e","c","i","push","k","datenum","v","date1904","epoch","Date","parse","UTC","sheet_from_array_of_arrays","data","opts","ws","cell_ref","XLSX","utils","encode_cell","t","z","SSF","_table","encode_range","Workbook","SheetNames","Sheets","s2ab","buf","ArrayBuffer","view","Uint8Array","charCodeAt","id","theTable","document","getElementById","console","log","oo","ws_name","wb","wbout","write","bookType","bookSST","type","saveAs","Blob","formatJson","jsonData","th","defaultTitle","unshift","title"],"mappings":"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","file":"Export2Excel.js","sourcesContent":["/* eslint-disable */\nrequire('script-loader!file-saver');\nrequire('script-loader!vendor/Blob');\nrequire('script-loader!xlsx/dist/xlsx.core.min');\nfunction generateArray(table) {\n    var out = [];\n    var rows = table.querySelectorAll('tr');\n    var ranges = [];\n    for (var R = 0; R < rows.length; ++R) {\n        var outRow = [];\n        var row = rows[R];\n        var columns = row.querySelectorAll('td');\n        for (var C = 0; C < columns.length; ++C) {\n            var cell = columns[C];\n            var colspan = cell.getAttribute('colspan');\n            var rowspan = cell.getAttribute('rowspan');\n            var cellValue = cell.innerText;\n            if (cellValue !== \"\" && cellValue == +cellValue) cellValue = +cellValue;\n\n            //Skip ranges\n            ranges.forEach(function (range) {\n                if (R >= range.s.r && R <= range.e.r && outRow.length >= range.s.c && outRow.length <= range.e.c) {\n                    for (var i = 0; i <= range.e.c - range.s.c; ++i) outRow.push(null);\n                }\n            });\n\n            //Handle Row Span\n            if (rowspan || colspan) {\n                rowspan = rowspan || 1;\n                colspan = colspan || 1;\n                ranges.push({s: {r: R, c: outRow.length}, e: {r: R + rowspan - 1, c: outRow.length + colspan - 1}});\n            }\n            ;\n\n            //Handle Value\n            outRow.push(cellValue !== \"\" ? cellValue : null);\n\n            //Handle Colspan\n            if (colspan) for (var k = 0; k < colspan - 1; ++k) outRow.push(null);\n        }\n        out.push(outRow);\n    }\n    return [out, ranges];\n};\n\nfunction datenum(v, date1904) {\n    if (date1904) v += 1462;\n    var epoch = Date.parse(v);\n    return (epoch - new Date(Date.UTC(1899, 11, 30))) / (24 * 60 * 60 * 1000);\n}\n\nfunction sheet_from_array_of_arrays(data, opts) {\n    var ws = {};\n    var range = {s: {c: 10000000, r: 10000000}, e: {c: 0, r: 0}};\n    for (var R = 0; R != data.length; ++R) {\n        for (var C = 0; C != data[R].length; ++C) {\n            if (range.s.r > R) range.s.r = R;\n            if (range.s.c > C) range.s.c = C;\n            if (range.e.r < R) range.e.r = R;\n            if (range.e.c < C) range.e.c = C;\n            var cell = {v: data[R][C]};\n            if (cell.v == null) continue;\n            var cell_ref = XLSX.utils.encode_cell({c: C, r: R});\n\n            if (typeof cell.v === 'number') cell.t = 'n';\n            else if (typeof cell.v === 'boolean') cell.t = 'b';\n            else if (cell.v instanceof Date) {\n                cell.t = 'n';\n                cell.z = XLSX.SSF._table[14];\n                cell.v = datenum(cell.v);\n            }\n            else cell.t = 's';\n\n            ws[cell_ref] = cell;\n        }\n    }\n    if (range.s.c < 10000000) ws['!ref'] = XLSX.utils.encode_range(range);\n    return ws;\n}\n\nfunction Workbook() {\n    if (!(this instanceof Workbook)) return new Workbook();\n    this.SheetNames = [];\n    this.Sheets = {};\n}\n\nfunction s2ab(s) {\n    var buf = new ArrayBuffer(s.length);\n    var view = new Uint8Array(buf);\n    for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;\n    return buf;\n}\n\nexport function export_table_to_excel(id) {\n    var theTable = document.getElementById(id);\n    console.log('a')\n    var oo = generateArray(theTable);\n    var ranges = oo[1];\n\n    /* original data */\n    var data = oo[0];\n    var ws_name = \"SheetJS\";\n    console.log(data);\n\n    var wb = new Workbook(), ws = sheet_from_array_of_arrays(data);\n\n    /* add ranges to worksheet */\n    // ws['!cols'] = ['apple', 'banan'];\n    ws['!merges'] = ranges;\n\n    /* add worksheet to workbook */\n    wb.SheetNames.push(ws_name);\n    wb.Sheets[ws_name] = ws;\n\n    var wbout = XLSX.write(wb, {bookType: 'xlsx', bookSST: false, type: 'binary'});\n\n    saveAs(new Blob([s2ab(wbout)], {type: \"application/octet-stream\"}), \"test.xlsx\")\n}\n\nfunction formatJson(jsonData) {\n    console.log(jsonData)\n}\nexport function export_json_to_excel(th, jsonData, defaultTitle) {\n\n    /* original data */\n\n    var data = jsonData;\n    data.unshift(th);\n    var ws_name = \"SheetJS\";\n\n    var wb = new Workbook(), ws = sheet_from_array_of_arrays(data);\n\n\n    /* add worksheet to workbook */\n    wb.SheetNames.push(ws_name);\n    wb.Sheets[ws_name] = ws;\n\n    var wbout = XLSX.write(wb, {bookType: 'xlsx', bookSST: false, type: 'binary'});\n    var title = defaultTitle || '列表'\n    saveAs(new Blob([s2ab(wbout)], {type: \"application/octet-stream\"}), title + \".xlsx\")\n}\n"]}